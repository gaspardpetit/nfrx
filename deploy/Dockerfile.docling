FROM --platform=$BUILDPLATFORM golang:1.24 AS build

ARG VERSION
ARG GIT_SHA
ARG BUILD_DATE

WORKDIR /src
COPY go.mod go.sum ./
RUN go mod download
COPY . .

RUN CGO_ENABLED=0 GOOS=linux go build -ldflags "-s -w -X main.version=${VERSION} -X main.buildSHA=${GIT_SHA} -X main.buildDate=${BUILD_DATE}" \
      -o /out/nfrx-docling ./modules/docling/agent/cmd/nfrx-docling

FROM gcr.io/distroless/base-debian12
COPY --from=build /out/nfrx-docling /nfrx-docling
ENTRYPOINT ["/nfrx-docling"]

